extends ../../layout

block body
  if domains.length > 0
    #modal-alias.modal.fade(
      tabindex="-1",
      role="dialog",
      aria-labelledby="modal-alias-title",
      aria-hidden="true",
      data-backdrop="static"
    )
      .modal-dialog.modal-lg(role="document")
        .modal-content
          .modal-header.text-center.d-block
            h4#modal-alias-title.d-inline-block.ml-4= t("Add New Alias")
            button.close(
              type="button",
              data-dismiss="modal",
              aria-label="Close"
            )
              span(aria-hidden="true") &times;
          .modal-body
            form.ajax-form(action=l("/my-account/aliases"), method="POST")
              include aliases/_form
              button.btn.btn-success.btn-block.btn-lg(type="submit")= t("Continue")

  include _modal-upgrade
  include _modal-domain

  .min-vh-80.d-flex.flex-column
    .container.py-3
      .row
        .col
          include ../../_breadcrumbs
      //-
        if temporaryErrorCount && permanentErrorCount
          .row.mb-3
            .col.rounded.border.bg-white.bg-themed.text-center
              .d-flex.flex-wrap
                .p-3.p-md-3.d-flex.flex-column.flex-grow-1.justify-content-center
                  h2.h6.text-muted.text-uppercase= t("Domains")
                  .display-4.font-weight-bold= numeral(domains.length).format("0,0")
                .p-3.p-md-4.d-flex.flex-column.flex-grow-1.justify-content-center
                  h2.h6.text-muted.text-uppercase= t("Aliases")
                  .display-4.font-weight-bold= numeral(_.sumBy(domains, "alias_count")).format("0,0")
                .p-3.p-md-4.d-flex.flex-column.flex-grow-1.justify-content-center
                  h2.h6.text-muted.text-uppercase
                    = t("Temporary Errors")
                    = "*"
                  .display-4.font-weight-bold= numeral(temporaryErrorCount).format("0,0")
                .p-3.p-md-4.d-flex.flex-column.flex-grow-1.justify-content-center
                  h2.h6.text-muted.text-uppercase
                    = t("Permanent Errors")
                    = "*"
                  .display-4.font-weight-bold= numeral(permanentErrorCount).format("0,0")
              p.text-center
                small.text-muted
                  = "*"
                  = " "
                  = t("Indicates count detected across all domains from previous 7 days.")
                  = " "
                  = t("See logs below for insight.")
      .row
        .col
          if domains.length === 0 && !ctx.query.q && (!ctx.query.page || ctx.query.page === 1)
            .alert.alert-info.text-center= t("No domains exist yet.")
          else
            if !ctx.query.page || ctx.query.page === 1
              - const mismatch = user.plan !== "free" && domains.some((d) => d.group === "admin" && d.plan !== user.plan);
              if mismatch
                .alert.alert-warning.small.text-center
                  != t('One or more of your domains are not on the <span class="notranslate">%s</span> plan.', t(titleize(humanize(user.plan))))
                  = " "
                  != t('Click "Change Plan" &rarr; "<span class="notranslate">%s</span>" to resolve if needed.', t(titleize(humanize(user.plan))))
            form.ajax-form.table-ajax-form(
              action=ctx.path,
              method="GET",
              data-table="#table-domains",
              data-search-params="q"
            )
              .input-group.mb-3
                input#input-keyword-search.form-control(
                  type="text",
                  value=ctx.query.q ? ctx.query.q : "",
                  name="q",
                  placeholder=t("Search")
                )
                .input-group-append
                  button.btn.btn-success(type="submit")= t("Search")
            #table-domains
              include ./_table
